require 'spec_helper'

describe FFI::Talib do
  subject { FFI::Talib }
  it 'should call simple moving average' do
    arr = (1..10).to_a
    subject.ta_macd(arr + arr.reverse + arr + arr.reverse + arr + arr.reverse + arr + arr.reverse).should == {:macd=>[0.5137834175930891, 0.38503418524748056, 0.20000234582858578, -0.027016928312470156, -0.28434522653338323, -0.5624873949226066, -0.8537670152284367, -1.0722480053229928, -1.1514311399517991, -1.120575406228479, -1.0038585162033304, -0.8212015964833044, -0.5889638206743584, -0.32052722913544773, -0.02678884853789043, 0.2834254251329913, 0.6030129566400015, 0.8465301057507366, 0.9479007484357771, 0.9367478246313414, 0.8375625102588478, 0.670536266687705, 0.4522617309360948, 0.19632285841348196, -0.0862084275619388, -0.3863544957471037, -0.6968808512112972, -0.9322290687264196, -1.0262229249707304, -1.0083979072137574, -0.9031686436467412, -0.7306594640013953, -0.5074040159715505, -0.24693431719065728, 0.039723530198255474, 0.34363240174001586, 0.6575936839822498, 0.8960808004514389, 0.9929458540902454, 0.9777495758404191, 0.8749291347519179, 0.7046290269503643, 0.4834009763713647, 0.22479323330951217, -0.060153496819397745, -0.36248892929282484, -0.6750025709253631], :hist=>[0.7063801470566767, 0.4621047317688545, 0.2216583138799678, -0.00428876820887052, -0.20929365314382686, -0.3899486572264402, -0.5449826220258163, -0.6107708896962979, -0.5519632194600834, -0.4168859885894106, -0.24013527885140973, -0.045982687305106906, 0.14900407080307132, 0.3339525298735856, 0.5021527283769143, 0.6498936016382368, 0.7755849065161976, 0.8152816445015462, 0.7333218297492693, 0.5777351247558669, 0.38283984830669854, 0.17265088378844468, -0.03649892157053247, -0.23395023527451625, -0.4131852169999496, -0.5706650281480916, -0.704953106889828, -0.7522410595239604, -0.6769879326146169, -0.5273303318861151, -0.3376808546552791, -0.13213734000794652, 0.07289448641751861, 0.2666913481587294, 0.44267935643811374, 0.5972705823838993, 0.7289854917009067, 0.7739780865360766, 0.6966745121399064, 0.5451825871120641, 0.3538897168188503, 0.14687168721383737, -0.059485090692129816, -0.25447426700318587, -0.43153679770567666, -0.587097784143283, -0.7196891406206569], :signal=>[-0.1925967294635876, -0.07707054652137396, -0.021655968051382007, -0.022728160103599637, -0.07505157338955636, -0.1725387376961664, -0.3087843932026204, -0.4614771156266949, -0.5994679204917157, -0.7036894176390683, -0.7637232373519207, -0.7752189091781975, -0.7379678914774297, -0.6544797590090333, -0.5289415769148047, -0.3664681765052455, -0.17257194987619606, 0.03124846124919045, 0.2145789186865078, 0.3590126998754746, 0.4547226619521492, 0.4978853828992604, 0.48876065250662726, 0.4302730936879982, 0.3269767894380108, 0.18431053240098788, 0.008072255678530843, -0.17998800920245928, -0.34923499235611355, -0.4810675753276423, -0.5654877889914621, -0.5985221239934487, -0.5802985023890691, -0.5136256653493867, -0.40295582623985826, -0.25363818064388344, -0.07139180771865677, 0.12210271391536237, 0.296271341950339, 0.43256698872835503, 0.5210394179330676, 0.557757339736527, 0.5428860670634945, 0.47926750031269805, 0.3713833008862789, 0.22460885485045815, 0.04468656969529389]}
  end

  it 'should return empty array if an empty one is given' do
    subject.ta_macd([]).should == []
  end

  it 'should raise error if no array is given' do
    expect { subject.ta_macd(nil) }.to raise_error('prices must be an array')
  end
end